<div class="container">
  <h1 class="page-title">Order Report</h1>

  <div class="msg-container" id="manageOrdersMsgContainer">
    <h5 class="alert alert-msg" id="manageOrdersMsg">{{ manageOrdersMessage }}</h5>
  </div>

  <div>
    <form id="searchCriteria"
      [formGroup]="orderDetails"
      (ngSubmit)="onSearchOrders()">
      <div id="dateInputFields">
        <input type="text"
          class="form-field two-ch"
          id="orderMonth"
          maxlength="2"
          placeholder="MM"
          (keyup)="onDateKeyDown($event, 'month', '#orderDay')"
          formControlName="month">
  
        <input type="text"
          class="form-field two-ch"
          id="orderDay"
          maxlength="2"
          placeholder="DD"
          (keyup)="onDateKeyDown($event, 'day', '#orderYear')"
          formControlName="day">
  
        <input type="text"
          class="form-field two-ch date-year"
          id="orderYear"
          maxlength="4"
          placeholder="YYYY"
          formControlName="year">
      </div>

      <div id="searchCriteriaBtnContainer">
        <button type="button"
          class="btn btn-sm btn-secondary"
          data-bs-toggle="modal"
          data-bs-target="#storeSelectionModal">Select Store</button>
  
        <button type="submit"
          class="btn btn-sm btn-secondary"
          id="manageOrdersBtn">Search</button>
      </div>

      <div *ngIf="month?.invalid" class="error-text">
        <span *ngIf="month?.errors?.['pattern']">Please enter a two digit number for the month</span>
      </div>

      <div *ngIf="day?.invalid" class="error-text">
        <span *ngIf="day?.errors?.['pattern']">Please enter a two digit number for the day</span>
      </div>

      <div *ngIf="year?.invalid" class="error-text">
        <span *ngIf="year?.errors?.['pattern']">Please enter a four digit number for the year</span>
      </div>
    </form>
  </div>

  <div class="row scrollable">
    <table>
      <tr>
        <td class="order-header">
          <h6 class="table-header">Order Id</h6>
        </td>

        <td class="order-header">
          <h6 class="table-header" (click)="onSortOrders('date')">
            <i class="fas fa-sort-up" id="dateOrderList"></i>
            <i class="fas fa-sort-down hide" id="dateOrderListReverse"></i>&nbsp;Date</h6>
        </td>

        <td class="order-header" (click)="onSortOrders('store')">
          <h6 class="table-header">
            <i class="fas fa-sort-up" id="storeOrderList"></i>
            <i class="fas fa-sort-down hide" id="storeOrderListReverse"></i>&nbsp;Store</h6>
        </td>

        <td class="order-header order-price" (click)="onSortOrders('totalValue')">
          <h6 class="table-header">
            <i class="fas fa-sort-up" id="totalValueOrderList"></i>
            <i class="fas fa-sort-down hide" id="totalValueOrderListReverse"></i>&nbsp;Total</h6>
        </td>
      </tr>

      <ng-container *ngFor="let order of orderList">
        <tr class="order-details">
          <td class="order-data">{{ order._id }}</td>

          <td class="order-data">{{ order.date }}</td>

          <td class="order-data">
            <div class="store-name">{{ $any(order).store[0].name }}</div>

            <div class="store-location">{{ $any(order).store[0].street }} {{ $any(order).store[0].city }}, {{ $any(order).store[0].state }} {{ $any(order).store[0].zip }}</div>
          </td>

          <td class="order-data order-price">{{ order.orderTotal }}</td>
        </tr>
      </ng-container>
    </table>
  </div>
</div>

<div class="modal fade"
  id="storeSelectionModal"
  tabindex="-1"
  aria-labelledby="storeSelectionModal"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Select Stores</h5>

        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body">
        <div id="storeSelectionContainer">
          <ng-container *ngFor="let store of storeList">
            <button class="btn btn-outline-secondary selection-btn"
              id="orders{{ store._id }}"
              (click)="onSelectStore(store._id)">
              <div id="plusContainer{{ store._id }}">
                <i class="fas fa-plus selection-plus"></i>
              </div>

              <div class="minus-container" id="minusContainer{{ store._id }}">
                <i class="fas fa-minus selection-minus"></i>
              </div>

              <span class="icon-btn-text">{{ store.name }}</span>
            </button>
          </ng-container>
        </div>
      </div>
    </div>
  </div>
</div>
